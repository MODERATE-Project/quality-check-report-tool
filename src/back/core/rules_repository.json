{
    "common_rules": [
        {
            "id": "rule_common_001",
            "type": "data_validation",
            "enabled": true,
            "description": "El municipio debe coincidir con los indicados en el listado de zonificación climática.",
            "severity": "error",
            "parameters": {
                "xpath": "//IdentificacionEdificio/Municipio",
                "valid_values_source": "Listado Poblaciones Zonificación Climática Comunidad Valenciana.xlsx"
            }
        },
        {
            "id": "rule_common_002",
            "type": "data_validation",
            "enabled": true,
            "description": "La zona climática debe corresponder al municipio según el listado de zonificación climática.",
            "severity": "error",
            "parameters": {
                "xpath": "//IdentificacionEdificio/ZonaClimatica",
                "dependent_field": "//IdentificacionEdificio/Municipio",
                "valid_values_source": "Listado Poblaciones Zonificación Climática Comunidad Valenciana.xlsx"
            }
        },
        {
            "id": "rule_common_003",
            "type": "data_validation",
            "enabled": true,
            "description": "El año de construcción debe ser un valor numérico de 4 dígitos.",
            "severity": "error",
            "parameters": {
                "xpath": "//IdentificacionEdificio/AnoConstruccion",
                "regex": "^\\d{4}$"
            }
        },
        {
            "id": "rule_common_004",
            "type": "business_rule",
            "enabled": true,
            "description": "Determina la normativa vigente según el año de construcción.",
            "severity": "error",
            "parameters": {
                "xpath": "//IdentificacionEdificio/NormativaVigente",
                "conditions": [
                    {
                        "range": {
                            "min": null,
                            "max": 1980
                        },
                        "expected_value": "Anterior/No aplicable"
                    },
                    {
                        "range": {
                            "min": 1981,
                            "max": 2007
                        },
                        "expected_value": "NBE-CT-79"
                    },
                    {
                        "range": {
                            "min": 2007,
                            "max": 2014
                        },
                        "expected_value": "CTE 2006"
                    },
                    {
                        "range": {
                            "min": 2014,
                            "max": 2019
                        },
                        "expected_value": "CTE 2013"
                    },
                    {
                        "range": {
                            "min": 2019,
                            "max": null
                        },
                        "expected_value": "CTE 2019"
                    }
                ]
            }
        },
        {
            "id": "rule_common_005",
            "type": "data_validation",
            "enabled": true,
            "description": "La referencia catastral debe cumplir con la longitud especificada según el tipo de edificio.",
            "severity": "error",
            "parameters": {
                "xpath": "//IdentificacionEdificio/ReferenciaCatastral",
                "dependent_field": "//IdentificacionEdificio/TipoDeEdificio",
                "lengths": {
                    "ViviendaUnifamiliar": [
                        13,
                        18
                    ],
                    "BloqueDeViviendaCompleto": [
                        13
                    ],
                    "ViviendaIndividualEnBloque": [
                        18
                    ],
                    "EdificioUsoTerciario": [
                        13,
                        18
                    ],
                    "LocalUsoTerciario": [
                        13,
                        18
                    ]
                }
            }
        },
        {
            "id": "rule_common_006",
            "type": "data_validation",
            "enabled": true,
            "description": "El tipo de edificio debe ser uno de los valores permitidos.",
            "severity": "error",
            "parameters": {
                "xpath": "//IdentificacionEdificio/TipoDeEdificio",
                "valid_values": [
                    "ViviendaUnifamiliar",
                    "BloqueDeViviendaCompleto",
                    "ViviendaIndividualEnBloque",
                    "EdificioUsoTerciario",
                    "LocalUsoTerciario"
                ]
            }
        },
        {
            "id": "rule_common_007",
            "type": "business_rule",
            "enabled": true,
            "description": "La versión del procedimiento debe ser compatible.",
            "severity": "error",
            "parameters": {
                "xpath": "//Procedimiento",
                "valid_versions": {
                    "CYPETHERM HE PLUS": "2025a",
                    "SG SAVE": "3502",
                    "TEKTON 3D": "1180",
                    "CERMA": "v.5.11",
                    "CE3X": "2.3",
                    "CE3": "20160906"
                }
            }
        },
        {
            "id": "rule_common_008",
            "type": "data_validation",
            "enabled": true,
            "description": "El alcance de la información XML debe ser uno de los valores permitidos.",
            "severity": "error",
            "parameters": {
                "xpath": "//AlcanceInformacionXML",
                "valid_values": [
                    "CertificacionExistente",
                    "VerificacionExistente",
                    "CertificacionVerificacionExistente",
                    "CertificacionNuevo",
                    "VerificacionNuevo",
                    "CertificacionVerificacionNuevo"
                ]
            }
        },
        {
            "id": "rule_common_009",
            "type": "business_rule",
            "enabled": true,
            "description": "Valida la relación entre alcance, año de construcción y actualizaciones.",
            "severity": "error",
            "parameters": {
                "xpath": "//AlcanceInformacionXML",
                "conditions": [
                    {
                        "values": [
                            "CertificacionExistente",
                            "VerificacionExistente",
                            "CertificacionVerificacionExistente"
                        ],
                        "year_range": {
                            "max": 2007
                        },
                        "prompt_on_error": "¿Se trata de una actualización de un certificado de eficiencia energética ya registrado?"
                    },
                    {
                        "values": [
                            "CertificacionNuevo",
                            "VerificacionNuevo",
                            "CertificacionVerificacionNuevo"
                        ],
                        "year_range": {
                            "min": 2008
                        }
                    }
                ]
            }
        },
        {
            "id": "rule_common_010",
            "type": "data_validation",
            "enabled": true,
            "description": "La fecha del certificado debe ser como máximo 30 días previa al registro.",
            "severity": "error",
            "parameters": {
                "xpath": "//DatosDelCertificador/Fecha",
                "max_days_difference": 30
            }
        },
        {
            "id": "rule_common_011",
            "type": "data_validation",
            "enabled": true,
            "description": "Los parámetros Imagen y Plano no deben estar vacíos.",
            "severity": "error",
            "parameters": {
                "xpaths": [
                    "//DatosGeneralesyGeometria/Imagen",
                    "//DatosGeneralesyGeometria/Plano"
                ],
                "not_empty": true
            }
        },
        {
            "id": "rule_common_012",
            "type": "data_validation",
            "enabled": true,
            "description": "Los parámetros Nombre, Descripcion y CosteEstimado no deben estar vacíos.",
            "severity": "error",
            "parameters": {
                "xpaths": [
                    "//MedidasDeMejora/Medida/Nombre",
                    "//MedidasDeMejora/Medida/Descripcion",
                    "//MedidasDeMejora/Medida/CosteEstimado"
                ],
                "not_empty": true
            }
        },
        {
            "id": "rule_common_013",
            "type": "data_validation",
            "enabled": true,
            "description": "La fecha de la visita debe ser como máximo 90 días previa a la emisión del certificado.",
            "severity": "error",
            "parameters": {
                "xpath": "//MedidasDeMejora/Visita/FechaVisita",
                "reference_xpath": "//DatosDelCertificador/Fecha",
                "max_days_difference": 90
            }
        }
    ],
    "models": {
        "modelo1": [
            {
                "id": "rule_modelo1_001",
                "type": "data_validation",
                "enabled": true,
                "description": "Ejemplo de regla para modelo1.",
                "severity": "error",
                "parameters": {
                    "xpath": "//modelo1/ejemplo",
                    "valid_values": [
                        "valor1",
                        "valor2"
                    ]
                }
            }
        ]
    }
}
